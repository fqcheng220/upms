-- MySQL Script generated by MySQL Workbench
-- Tue Jan 22 16:48:28 2019
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema db_stone_mall
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `db_stone_mall` ;

-- -----------------------------------------------------
-- Schema db_stone_mall
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `db_stone_mall` DEFAULT CHARACTER SET utf8 ;
USE `db_stone_mall` ;

-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_user`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_user` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_user` (
  `userId` INT NOT NULL AUTO_INCREMENT,
  `userName` VARCHAR(45) NOT NULL UNIQUE,
  `pwd` VARCHAR(45) NOT NULL,
  `realName` VARCHAR(45) NULL,
  `phone` VARCHAR(45) NOT NULL,
  `createTime` BIGINT(20) NOT NULL,
  PRIMARY KEY (`userId`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_role`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_role` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_role` (
  `roleId` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL UNIQUE,
  `createTime` BIGINT(20) NOT NULL,
  `description` VARCHAR(45) NULL,
  PRIMARY KEY (`roleId`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_user_role`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_user_role` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_user_role` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `userId` INT NOT NULL,
  `roleId` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY(`userId`,`roleId`),
  INDEX `fk_tb_upms_user_role_tb_upms_user_idx` (`userId` ASC),
  INDEX `fk_tb_upms_user_role_tb_upms_role1_idx` (`roleId` ASC),
  CONSTRAINT `fk_tb_upms_user_role_tb_upms_user`
    FOREIGN KEY (`userId`)
    REFERENCES `db_stone_mall`.`tb_upms_user` (`userId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_tb_upms_user_role_tb_upms_role1`
    FOREIGN KEY (`roleId`)
    REFERENCES `db_stone_mall`.`tb_upms_role` (`roleId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_system`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_system` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_system` (
  `systemId` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL UNIQUE,
  `description` VARCHAR(200) NULL,
  `status` TINYINT(4) NULL COMMENT '0禁止 1正常',
  `createTime` BIGINT(20) NOT NULL,
  PRIMARY KEY (`systemId`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_permission`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_permission` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_permission` (
  `permissionId` INT NOT NULL AUTO_INCREMENT,
  `permissionValue` VARCHAR(45) NOT NULL,
  `name` VARCHAR(45) NOT NULL UNIQUE,
  `createTime` DATE NULL,
  `type` TINYINT(4) NULL,
  `status` TINYINT(4) NOT NULL COMMENT '0禁止 1正常',
  `upms_system_systemId` INT NOT NULL,
  PRIMARY KEY (`permissionId`),
  INDEX `fk_tb_upms_permission_upms_system1_idx` (`upms_system_systemId` ASC),
  CONSTRAINT `fk_tb_upms_permission_upms_system1`
    FOREIGN KEY (`upms_system_systemId`)
    REFERENCES `db_stone_mall`.`tb_upms_system` (`systemId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;
alter table `db_stone_mall`.`tb_upms_permission` modify `name` VARCHAR(45) character set gbk;


-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_permission_role`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_permission_role` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_permission_role` (
  `id` INT NOT NULL,
  `permissionId` INT NOT NULL AUTO_INCREMENT,
  `roleId` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY(`permissionId`,`roleId`),
  INDEX `fk_tb_upms_permission_has_tb_upms_role_tb_upms_role1_idx` (`roleId` ASC),
  INDEX `fk_tb_upms_permission_has_tb_upms_role_tb_upms_permission1_idx` (`permissionId` ASC),
  CONSTRAINT `fk_tb_upms_permission_has_tb_upms_role_tb_upms_permission1`
    FOREIGN KEY (`permissionId`)
    REFERENCES `db_stone_mall`.`tb_upms_permission` (`permissionId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_tb_upms_permission_has_tb_upms_role_tb_upms_role1`
    FOREIGN KEY (`roleId`)
    REFERENCES `db_stone_mall`.`tb_upms_role` (`roleId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_stone_mall`.`tb_upms_user_permission`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `db_stone_mall`.`tb_upms_user_permission` ;

CREATE TABLE IF NOT EXISTS `db_stone_mall`.`tb_upms_user_permission` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `userId` INT NOT NULL,
  `permissionId` INT NOT NULL,
  UNIQUE KEY(`userId`,`permissionId`),
  INDEX `fk_tb_upms_user_has_tb_upms_permission_tb_upms_permission1_idx` (`permissionId` ASC),
  INDEX `fk_tb_upms_user_has_tb_upms_permission_tb_upms_user1_idx` (`userId` ASC),
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_tb_upms_user_has_tb_upms_permission_tb_upms_user1`
    FOREIGN KEY (`userId`)
    REFERENCES `db_stone_mall`.`tb_upms_user` (`userId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_tb_upms_user_has_tb_upms_permission_tb_upms_permission1`
    FOREIGN KEY (`permissionId`)
    REFERENCES `db_stone_mall`.`tb_upms_permission` (`permissionId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


insert into tb_upms_user values(1,'test','test','fake nick name','13112345678',20180101);
insert into tb_upms_user values(2,'admin','admin','fake nick name','13112345678',20180101);

insert into tb_upms_role values(1,'general',20180101,'general');
insert into tb_upms_role values(2,'super',20180101,'super');

insert into tb_upms_user_role values(1,1,1);
insert into tb_upms_user_role values(2,2,2);

insert into tb_upms_system values(1,'upms','',1,20180101);

insert into tb_upms_permission values(1,'upms:user:add','增加用户',20180101,0,1,1);
insert into tb_upms_permission values(2,'upms:user:add','删除用户',20180101,0,1,1);
insert into tb_upms_permission values(3,'upms:user:add','修改用户',20180101,0,1,1);
insert into tb_upms_permission values(4,'upms:user:add','查询所有用户',20180101,0,1,1);
insert into tb_upms_permission values(5,'upms:user:add','用户登录',20180101,0,1,1);
-- insert into tb_upms_permission values(2,'upms:user:del','删除用户',20180101,0,1,1);
-- insert into tb_upms_permission values(3,'upms:user:update','修改用户',20180101,0,1,1);
-- insert into tb_upms_permission values(4,'upms:user:listall','查询所有用户',20180101,0,1,1);
-- insert into tb_upms_permission values(5,'upms:user:login','用户登录',20180101,0,1,1);

insert into tb_upms_permission_role values(1,1,2);
insert into tb_upms_permission_role values(2,2,2);
insert into tb_upms_permission_role values(3,3,2);
insert into tb_upms_permission_role values(4,4,2);
insert into tb_upms_permission_role values(5,5,2);
insert into tb_upms_permission_role values(6,5,1);



